<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<source>
  @type http
  port 9880
  bind 0.0.0.0
  body_size_limit 32m
  keepalive_timeout 10s
</source>

# add tag prefix with log_type
<match {kubernetes.**,openshift-audit.log,journal.system,k8s-audit.log,linux-audit.log}>
 @type rewrite_tag_filter
 <rule>
   key log_type
   pattern ^(.+)$
   tag $1.${tag}
 </rule>
</match>

# add tag prefix with openshift.labels.cluster
<match {infrastructure.**,audit.**,application.**}>
 @type rewrite_tag_filter
 <rule>
   key $['openshift']['labels']['cluster']
   pattern ^(.+)$
   tag $1.${tag}
 </rule>
</match>

<match **>
  @type copy
  <store>
    @type elasticsearch
    host es01
    port 9200
    scheme https
    user elastic
    password StNqVMRqdeKJelx1A2eg
    logstash_format true
    logstash_prefix fluentd
    logstash_dateformat %Y%m%d
    include_tag_key true
    type_name access_log
    tag_key @log_name
    flush_interval 1s
    ssl_verify false
  </store>
  <store>
    @type stdout
  </store>
</match>

